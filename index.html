<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>HTML to PDF Upload</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<style>
			body {
				background: #f8f9fa;
			}
			.sharp-card {
				max-width: 420px;
				border-radius: 1.25rem;
				box-shadow: 0 4px 32px 0 #e0e0e0;
				border: 1.5px solid #e5e7eb;
				margin: 0 auto;
				transition: box-shadow 0.2s;
			}
			.sharp-card:hover {
				box-shadow: 0 8px 40px 0 #d1d5db;
			}
			.form-label {
				font-weight: 600;
			}
			.btn-primary,
			.btn-outline-secondary {
				font-size: 1.08rem;
				border-radius: 0.5rem;
				transition: box-shadow 0.15s, background 0.15s;
				box-shadow: 0 1px 4px 0 #e0e0e0;
			}
			.btn-primary:hover,
			.btn-outline-secondary:hover {
				box-shadow: 0 2px 8px 0 #bdbdbd;
			}
			.fw-bold {
				letter-spacing: 0.5px;
			}
			.form-control:focus {
				border-color: #0d6efd;
				box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.15);
			}
			.container {
				min-height: 100vh;
			}
			@media (max-width: 600px) {
				.sharp-card {
					padding: 1.25rem 0.5rem;
				}
			}
		</style>
	</head>
	<body>
		<div class="container py-5">
			<div class="mx-auto sharp-card bg-white p-4 p-md-5 mb-4">
				<div class="text-center mb-4">
					<h2 class="fw-bold mb-1">HTML to PDF Converter</h2>
					<div class="text-muted small">
						Upload your HTML and images, preview, and download
						as PDF
					</div>
				</div>
				<form
					id="uploadForm"
					autocomplete="off"
					class="needs-validation"
					novalidate
				>
					<div class="mb-3">
						<label
							for="htmlFile"
							class="form-label fw-semibold"
						>
							HTML File <span class="text-danger">*</span>
						</label>
						<input
							type="file"
							class="form-control"
							id="htmlFile"
							name="htmlFile"
							accept=".html,text/html"
							required
						/>
						<div class="invalid-feedback">
							Please select a valid .html file.
						</div>
					</div>
					<div class="mb-3">
						<label
							for="imageFiles"
							class="form-label fw-semibold"
						>
							Image Files
							<span class="text-muted"
								>(optional, multiple allowed)</span
							>
						</label>
						<input
							type="file"
							class="form-control"
							id="imageFiles"
							name="imageFiles"
							accept="image/*"
							multiple
						/>
						<div class="form-text">
							Reference these images in your HTML by their
							file name.
						</div>
					</div>
					<div
						class="d-flex gap-2 mt-4"
						id="actionBtns"
						style="display: none"
					>
						<button
							type="button"
							id="previewBtn"
							class="btn btn-outline-secondary w-50 py-2 fw-semibold"
						>
							Preview
						</button>
						<button
							type="submit"
							class="btn btn-primary w-50 py-2 fw-semibold"
						>
							Convert & Download PDF
						</button>
					</div>
				</form>
				<div
					id="errorMsg"
					class="text-danger mt-3 text-center"
				></div>
			</div>
			<footer class="text-center text-muted small">
				&copy; 2025 
				
				
					
		
				
				
			</footer>
		</div>

		<script>
			// Show/hide action buttons based on HTML file selection
			const htmlInput = document.getElementById('htmlFile');
			const actionBtns = document.getElementById('actionBtns');
			htmlInput.addEventListener('change', function () {
				const file = htmlInput.files[0];
				actionBtns.style.display =
					file && file.name.endsWith('.html') ? 'flex' : 'none';
			});

			// Preview button logic
			document
				.getElementById('previewBtn')
				.addEventListener('click', async function () {
					const fileInput = document.getElementById('htmlFile');
					const imageInput =
						document.getElementById('imageFiles');
					const file = fileInput.files[0];
					if (!file || !file.name.endsWith('.html')) {
						fileInput.classList.add('is-invalid');
						document.getElementById('errorMsg').textContent =
							'Please select a valid .html file.';
						return;
					}
					fileInput.classList.remove('is-invalid');
					document.getElementById('errorMsg').textContent = '';

					const formData = new FormData();
					formData.append('htmlFile', file);
					for (let img of imageInput.files) {
						formData.append('imageFiles', img);
					}
					try {
						const response = await fetch('/preview', {
							method: 'POST',
							body: formData,
						});
						if (!response.ok)
							throw new Error(
								'Failed to generate preview'
							);
						const html = await response.text();
						const previewWindow = window.open('', '_blank');
						previewWindow.document.open();
						previewWindow.document.write(html);
						previewWindow.document.close();
					} catch (err) {
						document.getElementById('errorMsg').textContent =
							err.message;
					}
				});

			// Form submit logic for PDF conversion
			(() => {
				'use strict';
				const form = document.getElementById('uploadForm');
				form.addEventListener(
					'submit',
					async function (e) {
						e.preventDefault();
						e.stopPropagation();

						const fileInput =
							document.getElementById('htmlFile');
						const file = fileInput.files[0];
						const imageInput =
							document.getElementById('imageFiles');

						if (!file || !file.name.endsWith('.html')) {
							fileInput.classList.add('is-invalid');
							document.getElementById(
								'errorMsg'
							).textContent =
								'Please select a valid .html file.';
							return;
						}
						fileInput.classList.remove('is-invalid');
						document.getElementById('errorMsg').textContent =
							'';

						const formData = new FormData();
						formData.append('htmlFile', file);
						for (let img of imageInput.files) {
							formData.append('imageFiles', img);
						}

						const submitBtn = form.querySelector(
							'button[type="submit"]'
						);
						submitBtn.disabled = true;
						submitBtn.textContent = 'Processing...';

						try {
							const response = await fetch('/upload', {
								method: 'POST',
								body: formData,
							});
							if (!response.ok)
								throw new Error(
									'Failed to convert HTML to PDF'
								);
							const blob = await response.blob();
							const url = window.URL.createObjectURL(blob);
							const a = document.createElement('a');
							a.href = url;
							a.download = 'converted.pdf';
							document.body.appendChild(a);
							a.click();
							a.remove();
							window.URL.revokeObjectURL(url);
						} catch (err) {
							document.getElementById(
								'errorMsg'
							).textContent = err.message;
						} finally {
							submitBtn.disabled = false;
							submitBtn.textContent =
								'Convert & Download PDF';
						}
					},
					false
				);
			})();
		</script>
	</body>
</html>
